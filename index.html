<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, viewport-fit=cover">

    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
    
    <script>
      function isInstagramBrowser() {
        const userAgent = navigator.userAgent || navigator.vendor || window.opera;
        return userAgent.indexOf("Instagram") > -1 || userAgent.indexOf("FBAN") > -1 || userAgent.indexOf("FBAV") > -1;
      }

      function showExitOverlay() {
        if (isInstagramBrowser()) {
          const overlay = document.createElement('div');
          overlay.id = 'instagram-overlay';
          overlay.style = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 2rem;
            box-sizing: border-box;
          `;

          overlay.innerHTML = `
            <div style="background-color: #1a1a1a; padding: 2rem; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.5);">
              <h2 style="color: #0070ba; margin-bottom: 1rem;">Per visualizzare la pagina</h2>
              <p style="color: #e0e0e0; font-size: 1.15rem; line-height: 1.6; margin-bottom: 1rem;">
                Il link non pu√≤ essere aperto correttamente qui.
              </p>
              <p style="color: #e0e0e0; font-size: 1.15rem; line-height: 1.6; margin-bottom: 1.5rem; text-align: left;">
                Per favore, segui queste istruzioni:
                <br><br>
                1. Clicca sui **tre puntini (...)** o sull'icona di condivisione nell'angolo in alto a destra.
                <br>
                2. Seleziona **"Apri nel browser"** (su iOS) o **"Apri con Chrome"** (su Android).
              </p>
              <button onclick="window.open(window.location.href, '_system');" style="background-color: #ff914d; color: #121212; padding: 1rem 2rem; border: none; border-radius: 0.85rem; font-weight: bold; cursor: pointer; font-size: 1.2rem; transition: background-color 0.3s; width: auto; max-width: 100%;">
                Apri nel browser
              </button>
            </div>
          `;
          document.body.appendChild(overlay);
        }
      }
      
      document.addEventListener('DOMContentLoaded', showExitOverlay);

      let guestCount = 1;
      const maxGuests = 5;

      function addGuestFields() {
        if (guestCount >= maxGuests) {
          alert("Puoi registrare un massimo di 5 ospiti.");
          return;
        }
        guestCount++;
        const container = document.getElementById('guests');
        const div = document.createElement('div');
        div.className = 'guest-block';
        div.innerHTML = `
          <h4>Guest ${guestCount}</h4>
          <label>Nome:</label>
          <input name="name" placeholder="Nome" class="FormC" required>
          <label>Cognome:</label>
          <input name="surname" placeholder="Cognome" class="FormC" required>
          <label>Email:</label>
          <input name="email" placeholder="Email" class="FormC" required>
          <label>Telefono:</label>
          <input name="phone" placeholder="Telefono" class="FormC" required>
          <button type="button" class="remove-btn" onclick="removeGuest(this)">Rimuovi</button>
        `;
        container.appendChild(div);
      }

      function removeGuest(button) {
        const block = button.parentElement;
        block.remove();
        guestCount--;
      }

      function toggleButtons() {
        const selected = document.querySelector('input[name="paymentMethod"]:checked')?.value;
        const paypalBtn = document.getElementById('paypalBtn');
        const offlineBtn = document.getElementById('offlineBtn');

        if (selected === 'paypal') {
          paypalBtn.style.opacity = '1';
          paypalBtn.style.maxHeight = '50px';
          paypalBtn.style.padding = '1.4rem 1.7rem';
          offlineBtn.style.opacity = '0';
          offlineBtn.style.maxHeight = '0';
          offlineBtn.style.padding = '0';
        } else {
          paypalBtn.style.opacity = '0';
          paypalBtn.style.maxHeight = '0';
          paypalBtn.style.padding = '0';
          offlineBtn.style.opacity = '1';
          offlineBtn.style.maxHeight = '50px';
          offlineBtn.style.padding = '1.4rem 1.7rem';
        }
      }
      
      function toggleWarning() {
        const selected = document.querySelector('input[name="paymentMethod"]:checked')?.value;
        const paypalWarning = document.getElementById('paypal-warning');
        if (selected === 'paypal') {
          paypalWarning.classList.add('open');
        } else {
          paypalWarning.classList.remove('open');
        }
      }
      
      function onPaymentChange() {
        toggleButtons();
        toggleWarning();
      }

      function showThankYou(method) {
        const content = document.getElementById('content');
        let thankYouMessage = `
          <div class="info-block" style="background:#1e1e1e;">
            <h2 class="center-text" style="color: #0070ba;">Grazie per la pre-iscrizione!</h2>
            <p class="center-text" style="color: #b0b0b0;">Hai completato con successo la registrazione all'evento.</p>
        `;

        if (method === 'paypal') {
          thankYouMessage += `<p class="center-text" style="color: #b0b0b0;">Il pagamento √® stato avviato tramite PayPal. Controlla il tuo browser per completare la transazione.</p>`;
        } else {
          thankYouMessage += `
            <p class="center-text" style="color: #b0b0b0;">Per completare l'iscrizione, clicca sul link qui sotto e procedi al pagamento offline.</p>
            <div class="button-container"><a href="https://ig.me/m/lostinparea" target="_blank"><button type="button" class="full-width-button">Clicca qui per completare il pagamento.</button></a></div>
          `;
        }
        
        thankYouMessage += `
            <p class="center-text" style="color: #b0b0b0;">Dopo la validazione del pagamento, riceverai un QR code da mostrare all'ingresso. </p>
            <p class="center-text" style="color: #b0b0b0;">Controlla anche la cartella spam per eventuali email di conferma.</p>
            <p class="center-text" style="color: #b0b0b0;">Per qualsiasi dubbio, contattaci pure.</p>
          </div>
        `;

        content.innerHTML = thankYouMessage;
      }

      function handleSubmit() {
        try {
          const blocks = document.querySelectorAll('.guest-block');
          const guests = [];

          blocks.forEach(b => {
            const inputs = b.querySelectorAll('input');
            guests.push({
              name: inputs[0].value,
              surname: inputs[1].value,
              email: inputs[2].value,
              phone: inputs[3].value
            });
          });

          const method = document.querySelector('input[name="paymentMethod"]:checked')?.value;

          if (!method) {
            alert('Seleziona un metodo di pagamento.');
            return false;
          }

          google.script.run.withSuccessHandler((res) => {
            localStorage.setItem('groupId', res.groupId);
            showThankYou(method);
            if (method === 'paypal' && res.paypalUrl) {
              window.open(res.paypalUrl, '_blank');
            }
          }).handleFormSubmission({
            guests: JSON.stringify(guests),
            paymentMethod: method
          });

          return false;
        } catch (e) {
          console.error(e);
          alert('Errore nel form. Riprova.');
          return false;
        }
      }

      document.addEventListener('DOMContentLoaded', () => {
        onPaymentChange();
      });
    </script>

    <style>
      /* --- Reset e stili di base per MOBILE (Mobile-First) --- */
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      
      html {
        font-size: 18.4px;
        -webkit-text-size-adjust: 100%;
        -ms-text-size-adjust: 100%;
        width: 100%;
        height: 100%;
      }
      
      body {
        font-family: Arial, sans-serif;
        background-color: #000000;
        color: #e0e0e0;
        font-size: 1.15rem;
        line-height: 1.6;
        width: 100%;
        height: 100%;
        overflow-x: hidden;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
      
      .container {
        width: 100%;
        min-height: 100vh;
        margin: 0;
        padding: 0.8rem;
        background-color: #000000;
        position: relative;
        /* max-width: 100vw; */
        box-sizing: border-box;
      }
      
      .header {
        text-align: center;
        margin-bottom: 1.7rem;
        width: 100%;
      }
      
      .header img {
        width: 100%;
        max-width: 100%;
        max-height: 40vh;
        object-fit: contain;
        border-radius: 0;
        display: block;
      }
      
      h2, h3 {
        text-align: center;
        color: #0070ba;
        font-size: 1.7rem;
        margin-bottom: 1.15rem;
        line-height: 1.3;
        width: 100%;
      }
      
      h4 {
        color: #0070ba;
        border-bottom: 1px solid #333;
        padding-bottom: 0.6rem;
        margin-top: 0;
        text-align: left;
        font-size: 1.45rem;
        width: 100%;
      }
      
      h5 {
        color: #0070ba;
        font-size: 1.25rem;
        margin: 1.15rem 0 0.6rem 0;
      }
      
      p {
        line-height: 1.6em;
        color: #b0b0b0;
        font-size: 1.15rem;
        margin-bottom: 0.6rem;
        text-align: left;
        width: 100%;
        word-wrap: break-word;
      }
      
      .center-text {
        text-align: center;
      }

      /* Stili del form e elementi specifici */
      form {
        margin-top: 1.7rem;
        width: 100%;
      }
      
      .guest-block {
        margin-bottom: 1.7rem;
        padding: 1.15rem;
        border-radius: 0.6rem;
        position: relative;
        background-color: #2a2a2a;
        box-shadow: inset 0 0 11.5px rgba(0, 0, 0, 0.5);
        width: 100%;
      }
      
      .remove-btn {
        position: absolute;
        top: 0.6rem;
        right: 0.6rem;
        background-color: #c0392b;
        color: white;
        border: none;
        padding: 0.35rem 0.7rem;
        border-radius: 0.3rem;
        cursor: pointer;
        font-size: 0.9rem;
        width: auto;
      }
      
      .remove-btn:hover { 
        background-color: #e74c3c; 
      }
      
      label {
        display: block;
        margin-top: 0.6rem;
        font-weight: bold;
        color: #e0e0e0;
        font-size: 1.15rem;
        width: 100%;
      }
      
      input[type="text"], input[type="email"], input[type="tel"] {
        width: 100%;
        padding: 1.4rem;
        margin: 0.25rem 0 0.9rem 0;
        border: 2px solid #333;
        border-radius: 0.85rem;
        background-color: #2a2a2a;
        color: #fff;
        box-shadow: inset 0 2px 6px rgba(0,0,0,0.4);
        transition: border-color 0.3s, box-shadow 0.3s;
        font-size: 18.4px;
        -webkit-appearance: none;
        min-height: 3.4rem;
      }
      
      input[type="text"]:focus, input[type="email"]:focus, input[type="tel"]:focus {
        border-color: #0070ba;
        outline: none;
        box-shadow: 0 0 5px #0070ba;
      }
      
      input[type="checkbox"] {
        margin-right: 0.6rem;
        transform: scale(1.25);
      }
      
      .FormC {
      	width: 100%;
        height: 3.4rem;
      }

      .warning-note {
        color: #f39c12;
        padding: 0.9rem;
        background-color: #2a2a2a;
        border-left: 3px solid #f39c12;
        text-align: left;
        margin-top: 1.7rem;
        font-size: 1.1rem;
        width: 100%;
      }
      
      .warning-dropdown {
        background-color: #333;
        color: #e0e0e0;
        padding: 0;
        border-radius: 0.6rem;
        margin-top: 0;
        max-height: 0;
        overflow: hidden;
        opacity: 0;
        transition: max-height 0.5s ease-out, opacity 0.5s ease-out, padding 0.5s ease-out;
        width: 100%;
      }
      
      .warning-dropdown.open {
        max-height: 230px;
        opacity: 1;
        padding: 0.9rem;
        margin-bottom: 1.15rem;
      }
      
      .warning-dropdown p {
        text-align: left;
        margin: 0;
        font-weight: bold;
        color: #e0e0e0;
        font-size: 1.1rem;
      }

      /* Stili pulsanti e opzioni di pagamento */
      button {
        background-color: #ff914d;
        color: #121212;
        padding: 1.4rem 1.7rem;
        border: none;
        border-radius: 0.85rem;
        cursor: pointer;
        margin-top: 0.6rem;
        font-weight: bold;
        transition: background-color 0.3s, opacity 0.5s, max-height 0.5s, padding 0.5s;
        -webkit-appearance: none;
        min-height: 3.7rem;
        width: 100%; /* Default a tutta larghezza */
        font-size: 1.15rem;
      }
      
      button:hover, button:active { 
        background-color: #ff7f33; 
      }
      
      .remove-btn {
        width: auto;
      }
      
      .button-container {
        text-align: center;
        margin-top: 1.7rem;
        width: 100%;
      }
      
      .button-container a {
        display: block;
        width: 100%;
      }
      
      /* Modifiche per allineamento pulsanti di pagamento */
      .payment-button-container {
        display: flex;
        justify-content: center;
        width: 100%;
      }

      .payment-button {
        transition: opacity 0.3s, max-height 0.3s, padding 0.3s;
      }

      .payment-button.hidden {
        opacity: 0;
        max-height: 0;
        padding: 0;
        margin: 0;
      }

      .payment-options {
        display: flex;
        flex-direction: column;
        gap: 0.6rem;
        margin-bottom: 1.15rem;
        width: 100%;
      }
      
      .payment-option {
        display: flex;
        align-items: center;
        padding: 1.4rem 1.15rem;
        border: 2px solid #444;
        border-radius: 0.85rem;
        background-color: #2a2a2a;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        font-size: 1.15rem;
        width: 100%;
        min-height: 3.7rem;
      }
      
      .payment-option:hover { 
        background-color: #333; 
      }
      
      .payment-option input[type="radio"] { 
        display: none; 
      }
      
      .payment-option span {
        display: block;
        font-weight: normal;
        padding-left: 2.3rem;
        position: relative;
      }
      
      .payment-option span::before {
        content: '';
        position: absolute;
        left: 0;
        top: 50%;
        transform: translateY(-50%);
        width: 1.15rem;
        height: 1.15rem;
        border: 2px solid #888;
        border-radius: 50%;
        background-color: transparent;
        transition: all 0.3s ease;
      }
      
      .payment-option input[type="radio"]:checked + span::before {
        border-color: #0070ba;
        background-color: #0070ba;
        box-shadow: 0 0 5px #0070ba;
      }
      
      .payment-option input[type="radio"]:checked + span::after {
        content: '';
        position: absolute;
        left: 0.35rem;
        top: 50%;
        transform: translateY(-50%);
        width: 0.7rem;
        height: 0.7rem;
        background-color: #2a2a2a;
        border-radius: 50%;
      }
      
      .payment-option input[type="radio"]:checked + span {
        color: #0070ba;
        font-weight: bold;
      }

      .info-block {
        margin: 1.7rem 0;
        padding: 1.15rem;
        background-color: #2a2a2a;
        border-radius: 0.6rem;
        box-shadow: inset 0 0 9.2px rgba(0,0,0,0.4);
        width: 100%;
      }
      
      .info-block ul {
        list-style-type: none;
        padding: 0;
        margin-top: 0.6rem;
        width: 100%;
      }
      
      .info-block li {
        padding: 0.3rem 0;
        color: #b0b0b0;
        font-size: 1.15rem;
        word-wrap: break-word;
      }
      
      .info-block li strong {
        color: #0070ba;
      }
      
      .info-block li span {
        color: #e0e0e0;
      }
      
      .price-info {
        font-size: 1.4rem;
        font-weight: bold;
        color: #0070ba;
        text-align: center;
        margin: 1.15rem 0;
      }

      /* --- MEDIA QUERY per TABLET e DESKTOP (768px+) --- */
      @media screen and (min-width: 768px) {
        body {
          font-size: 1rem;
        }
        
        .container {
          max-width: 600px;
          margin: 20px auto;
          padding: 20px;
          background-color: #1e1e1e;
          border-radius: 10px;
          box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
          width: auto;
        }
        
        h2, h3 {
          font-size: 2rem;
          margin-bottom: 1rem;
        }
        
        h4 {
          font-size: 1.5rem;
          padding-bottom: 0.5rem;
        }

        h5 {
          font-size: 1.1rem;
          margin: 1rem 0 0.5rem 0;
        }
        
        p {
          font-size: 1rem;
          line-height: 1.6em;
        }
        
        label {
          font-size: 1rem;
        }

        input[type="text"], input[type="email"], input[type="tel"] {
          padding: 1rem;
          font-size: 16px;
          min-height: auto;
          border-radius: 0.25rem;
        }
        
        .guest-block {
          padding: 1.5rem;
          border-radius: 0.5rem;
        }

        button {
          padding: 12px 25px;
          font-size: 1rem;
          width: auto;
          min-height: auto;
          border-radius: 0.25rem;
        }
        
        .button-container {
          margin-top: 1.5rem;
        }
        
        .button-container a {
          display: inline-block;
          width: auto;
        }
        
        .payment-option {
          padding: 1rem 1.5rem;
          font-size: 1rem;
          min-height: auto;
          border-radius: 0.5rem;
        }
        
        .payment-option span {
          padding-left: 2rem;
        }
        
        .payment-option span::before {
          width: 1.2rem;
          height: 1.2rem;
        }
        
        .payment-option input[type="radio"]:checked + span::after {
          left: 0.4rem;
          width: 0.8rem;
          height: 0.8rem;
        }
        
        .warning-note {
          font-size: 1.1rem;
          padding: 1rem;
        }
        
        .warning-dropdown.open {
          padding: 1rem;
        }

        .info-block {
          padding: 1.5rem;
          border-radius: 0.5rem;
        }
        
        .info-block ul {
          margin-top: 0.5rem;
        }

        .info-block li {
          font-size: 1rem;
        }
      }
    </style>
  </head>
  <body>
    <div id="content" class="container">
    
      <!--
      <div class="header">
        <img src="https://drive.google.com/thumbnail?id=1yTordpXPBJj2tVYBHhirLSHHQ06KXOlu" alt="Immagine dell'evento">
      </div>
      -->
      
      <h3 class="center-text">MIDSUMMER NIGHT PAREA</h3>
      
      <div class="info-block">
          <h4>üìç Dove e Quando</h4>
          <ul>
              <li><strong>Data:</strong> <span>14 agosto 2025</span></li>
              <li><strong>Location:</strong> <span>Masseria Palmieri</span></li>
              <li><strong>Start:</strong> <span>h 23.00 - hasta ma√±ana</span></li>
          </ul>
          <div class="button-container">
              <a href="https://maps.app.goo.gl/8yUGT78oLMXUPj6G6?g_st=ipc" target="_blank">
                  <button type="button">Location</button>
              </a>
          </div>
      </div>
      
      <div class="info-block">
          <h4>‚ÑπÔ∏è Info Utili</h4>
          <ul>
           <li><strong>Contributo:</strong> <span>30 ‚Ç¨</span></li>
           <li><strong>Drink:</strong> <span>Open bar üçπ</span></li>
          </ul>
      </div>
      
      <div class="info-block">
          <h4>üéß Dj Set</h4>
          <h5 class="subtitle"><strong>Line-up</strong></h5>
          <ul>
              <li>SA-RAY</li>
              <li>LEOLSS</li>
              <li>SIRADA</li>
              <li>STECKHINI x Mm53</li>
          </ul>
          <h5 class="subtitle"><strong>Sonorizzazione dell'alba</strong></h5>
          <ul>
              <li>SYNAPSYS</li>
          </ul>
      </div>
      
      <p class="center-text">Non vediamo l'ora di passare una serata indimenticabile insieme a voi! ‚ú®</p>
      <p class="center-text">Vi aspettiamo,<br>Team Parea</p>
      
      <form onsubmit="return handleSubmit()">
        <h3 class="center-text">Form di Iscrizione</h3>
        
        <div class="info-block">
          <p class="warning-note">
              <strong>‚ö†Ô∏è Nota Bene: La compilazione del form non garantisce l'inclusione all'evento.
              La partecipazione √® ufficializzata solo dopo il versamento del contributo e la successiva ricezione del QR code.</strong>
          </p>
        </div>

        <div id="guests">
          <div class="guest-block">
            <h4>Guest</h4>
            <label>Nome:</label>
            <input name="name" placeholder="Nome" class="FormC" required>
            <label>Cognome:</label>
            <input name="surname" placeholder="Cognome" class="FormC" required>
            <label>Email:</label>
            <input name="email" placeholder="Email" class="FormC" required>
            <label>Telefono:</label>
            <input name="phone" placeholder="Telefono" class="FormC" required>
          </div>
        </div>
        
        <div class="button-container">
            <button type="button" onclick="addGuestFields()">+ Aggiungi Guest</button>
        </div>

        <h3 style="margin-top: 2.5rem;">Metodo di pagamento</h3>
        <div class="payment-options">
          <label class="payment-option">
            <input type="radio" name="paymentMethod" value="paypal" onchange="onPaymentChange()"> <span>PayPal</span>
          </label>
          <div id="paypal-warning" class="warning-dropdown">
              <p>Ti preghiamo di spuntare la voce "Amici e Familiari". Il contributo includer√† tutti gli ospiti che hai registrato nel form di cui sopra.</p>
          </div>
          <label class="payment-option">
            <input type="radio" name="paymentMethod" value="revolut" onchange="onPaymentChange()"> <span>Revolut / Carta di Credito</span>
          </label>
          <label class="payment-option">
            <input type="radio" name="paymentMethod" value="satispay" onchange="onPaymentChange()"> <span>Satispay</span>
          </label>
        </div>

        <label style="margin-top:20px; font-weight:normal; text-align: left;"><input type="checkbox" required> Acconsento al trattamento dei miei dati per l'organizzazione dell'evento e all'utilizzo della mia immagine (foto/video) sui canali di comunicazione di Parea.</label>

        <div class="button-container payment-button-container">
            <button type="submit" id="paypalBtn" class="payment-button">Paga con PayPal</button>
            <button type="submit" id="offlineBtn" class="payment-button hidden">Paga Offline</button>
        </div>
      </form>
      
      <div class="info-block">
          <h4>üîó Link e Contatti</h4>
          <p>Seguici per non perderti news, storie e foto dei nostri eventi!</p>
          <div class="button-container">
              <a href="https://www.instagram.com/lostinparea?igsh=NTI3Y3VjM3AwNWVl" target="_blank">
                  <button type="button">Instagram</button>
              </a>
          </div>
          <p style="margin-top: 1.5rem;">Entra nella Community WhatsApp ufficiale per aggiornamenti in tempo reale.</p>
          <div class="button-container">
              <a href="https://chat.whatsapp.com/EOfaTPumoLv6alEZxCAVCs?mode=ac_t" target="_blank">
                  <button type="button">Whatsapp Community</button>
              </a>
          </div>
          <p style="margin-top: 1.5rem;">Hai ancora qualche dubbio? Siamo qui per aiutarti.</p>
          <div class="button-container">
              <a href="https://ig.me/m/lostinparea" target="_blank">
                  <button type="button">Contattaci</button>
              </a>
          </div>
      </div>
    </div>
  </body>

</html>
